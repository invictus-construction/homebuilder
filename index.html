<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invictus Construction Sarnia - Simple Framing Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
        }
        .card {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 8px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input, select, button {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        h2 {
            font-size: 20px;
            margin-bottom: 15px;
        }
        .results {
            list-style-type: disc;
            padding-left: 20px;
        }
        .total-cost {
            font-weight: bold;
            margin-top: 10px;
        }
        canvas {
            border: 1px solid #ccc;
            margin-top: 20px;
            display: block;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <h1>Invictus Construction Sarnia - Simple Framing Tool</h1>
    <div class="container">
        <div class="card">
            <h2>Building Dimensions</h2>
            <div class="input-group">
                <label for="length">Length (ft-in):</label>
                <input type="text" id="length" value="20-0">
            </div>
            <div class="input-group">
                <label for="width">Width (ft-in):</label>
                <input type="text" id="width" value="16-0">
            </div>
            <div class="input-group">
                <label for="height">Wall Height (ft-in):</label>
                <input type="text" id="height" value="8-0">
            </div>
            <div class="input-group">
                <label for="studSpacing">Stud Spacing (inches):</label>
                <input type="number" id="studSpacing" value="16">
            </div>
            <div class="input-group">
                <label for="roofPitch">Roof Pitch (X:12):</label>
                <input type="number" id="roofPitch" value="6">
            </div>
            <div class="input-group">
                <label for="lumberSize">Lumber Size:</label>
                <select id="lumberSize">
                    <option value="2x4">2x4</option>
                    <option value="2x6">2x6</option>
                    <option value="2x10">2x10</option>
                    <option value="LVL9.25">LVL 1-3/4 x 9-1/4</option>
                    <option value="LVL11.875">LVL 1-3/4 x 11-7/8</option>
                </select>
            </div>
            <div class="input-group">
                <label for="eaveOverhang">Eave Overhang (inches):</label>
                <input type="number" id="eaveOverhang" value="12">
            </div>
            <div class="input-group">
                <label for="gableOverhang">Gable Overhang (inches):</label>
                <input type="number" id="gableOverhang" value="12">
            </div>
            <h2>Framing Details</h2>
            <div class="input-group">
                <label for="kingStudsPerOpening">King Studs Per Opening:</label>
                <input type="number" id="kingStudsPerOpening" value="2">
            </div>
            <div class="input-group">
                <label for="jackStudsPerOpening">Jack Studs Per Opening:</label>
                <input type="number" id="jackStudsPerOpening" value="2">
            </div>
            <div class="input-group">
                <label for="blockingOption">Add Blocking/Strapping:</label>
                <select id="blockingOption">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </select>
            </div>
            <h2>Openings</h2>
            <div class="input-group">
                <label for="openingType">Type:</label>
                <select id="openingType">
                    <option value="Door">Door</option>
                    <option value="Window">Window</option>
                </select>
            </div>
            <div class="input-group">
                <label for="openingWidth">Width (inches):</label>
                <input type="number" id="openingWidth" value="36">
            </div>
            <div class="input-group">
                <label for="openingLocation">Location on Wall (ft-in):</label>
                <input type="text" id="openingLocation" value="5-0">
            </div>
            <button onclick="addOpening()">Add Opening</button>
            <ul id="openingsList"></ul>
            <button onclick="resetAll()" style="margin-top: 10px;">Reset</button>
        </div>
        <div class="card">
            <h2>Materials Needed</h2>
            <ul class="results">
                <li>Wall Studs: <span id="studCount">0</span></li>
                <li>Plates: <span id="plateCount">0</span></li>
                <li>Rafters: <span id="rafterCount">0</span></li>
                <li>Ridge Beam: <span id="ridgeBeam">0</span></li>
                <li>Fly Rafters: <span id="flyRafters">0</span></li>
                <li>Blocking Pieces: <span id="blockingCount">0</span></li>
                <li>King Studs: <span id="kingStuds">0</span></li>
                <li>Jack Studs: <span id="jackStuds">0</span></li>
                <li>Headers: <span id="headerCount">0</span></li>
                <li>Hurricane Ties: <span id="hurricaneTies">0</span></li>
                <li>Rafter Hangers: <span id="rafterHangers">0</span></li>
                <li>Collar Ties: <span id="collarTies">0</span></li>
                <li>Joist Hangers: <span id="joistHangers">0</span></li>
                <li>Birdsmouth Angle: <span id="birdsmouthAngle">0</span>°</li>
                <li>Full Rafter Length: <span id="fullRafterLength">0</span> ft-in</li>
                <li class="total-cost">Estimated Cost: $<span id="totalCost">0.00</span></li>
            </ul>
            <canvas id="topViewCanvas" width="500" height="300"></canvas>
            <canvas id="sideViewCanvas" width="500" height="300"></canvas>
            <canvas id="frontViewCanvas" width="500" height="300"></canvas>
            <h2>Rafter Diagram</h2>
            <canvas id="rafterDiagram" width="500" height="300"></canvas>
        </div>
    </div>

    <script>
        let openings = [];
        let scale = 10; // Pixels per inch
        let studThickness = { '2x4': 3.5, '2x6': 5.5, '2x10': 9.25 }; // Thickness in inches

        function parseFeetInches(input) {
            const [feet, inches = 0] = input.split('-').map(Number);
            return (feet || 0) + ((inches || 0) / 12);
        }

        function inchesToFeetInches(value) {
            const ft = Math.floor(value / 12);
            const inch = Math.round(value % 12);
            return `${ft}' ${inch}"`;
        }

        function setup() {
            createCanvas(500, 300).parent("topViewCanvas");
            noLoop();

            createCanvas(500, 300).parent("sideViewCanvas");
            noLoop();

            createCanvas(500, 300).parent("frontViewCanvas");
            noLoop();

            createCanvas(500, 300).parent("rafterDiagram");
            noLoop();

            updateAll();
        }

        function drawTopView() {
            let length = parseFeetInches(document.getElementById('length').value) * 12;
            let width = parseFeetInches(document.getElementById('width').value) * 12;
            let studSpacing = parseFloat(document.getElementById('studSpacing').value);
            let eaveOverhang = parseFloat(document.getElementById('eaveOverhang').value);
            let gableOverhang = parseFloat(document.getElementById('gableOverhang').value);
            let lumberSize = document.getElementById('lumberSize').value;

            background(255);
            stroke(0);
            strokeWeight(1);
            noFill();
            translate(100, 100);

            // Walls
            let thickness = studThickness[lumberSize] * scale;
            rect(-length * scale / 2, -width * scale / 2, length * scale, width * scale);
            // Studs
            let studsLength = Math.floor(length / studSpacing) + 1;
            let studsWidth = Math.floor(width / studSpacing) + 1;
            for (let i = 0; i <= studsLength; i++) {
                let x = -length * scale / 2 + (i * studSpacing) * scale;
                rect(x - thickness / 2, -width * scale / 2 - thickness, thickness, thickness);
                rect(x - thickness / 2, width * scale / 2, thickness, thickness);
            }
            for (let i = 0; i <= studsWidth; i++) {
                let y = -width * scale / 2 + (i * studSpacing) * scale;
                rect(-length * scale / 2 - thickness, y - thickness / 2, thickness, thickness);
                rect(length * scale / 2, y - thickness / 2, thickness, thickness);
            }
            // Rafters
            let rafterCount = Math.floor(length / studSpacing) + 1;
            let rafterThickness = studThickness['2x6'] * scale;
            for (let i = 0; i <= rafterCount; i++) {
                let x = -length * scale / 2 + (i * studSpacing) * scale;
                rect(x - rafterThickness / 2, -width * scale / 2 - gableOverhang * scale, rafterThickness, width * scale + 2 * gableOverhang * scale);
            }
            // Roof outline
            rect(-length * scale / 2 - eaveOverhang * scale, -width * scale / 2 - gableOverhang * scale, (length + 2 * eaveOverhang) * scale, (width + 2 * gableOverhang) * scale);
            textSize(12);
            fill(0);
            text("Top View", -length * scale / 2, -width * scale / 2 - 20);
        }

        function drawSideView() {
            let width = parseFeetInches(document.getElementById('width').value) * 12;
            let height = parseFeetInches(document.getElementById('height').value) * 12;
            let studSpacing = parseFloat(document.getElementById('studSpacing').value);
            let pitch = parseFloat(document.getElementById('roofPitch').value);
            let gableOverhang = parseFloat(document.getElementById('gableOverhang').value);
            let lumberSize = document.getElementById('lumberSize').value;

            background(255);
            stroke(0);
            strokeWeight(1);
            noFill();
            translate(100, 200);

            // Walls
            rect(-width * scale / 2, -height * scale, width * scale, height * scale);
            // Studs
            let studs = Math.floor(width / studSpacing) + 1;
            let thickness = studThickness[lumberSize] * scale;
            for (let i = 0; i <= studs; i++) {
                let x = -width * scale / 2 + (i * studSpacing) * scale;
                line(x - thickness / 2, -height * scale, x - thickness / 2, 0);
                line(x + thickness / 2, -height * scale, x + thickness / 2, 0);
            }
            // Roof and rafters
            let roofHeight = (width / 2) * (pitch / 12) * scale;
            line(-width * scale / 2 - gableOverhang * scale, -height * scale, 0, -height * scale - roofHeight);
            line(0, -height * scale - roofHeight, width * scale / 2 + gableOverhang * scale, -height * scale);
            let rafterCount = Math.floor(width / studSpacing) + 1;
            let rafterThickness = studThickness['2x6'] * scale;
            for (let i = 0; i <= rafterCount; i++) {
                let xStart = -width * scale / 2 - gableOverhang * scale;
                let xEnd = width * scale / 2 + gableOverhang * scale;
                line(xStart - rafterThickness / 2, -height * scale, xEnd - rafterThickness / 2, -height * scale);
                line(xStart + rafterThickness / 2, -height * scale, xEnd + rafterThickness / 2, -height * scale);
            }
            // Openings
            openings.forEach(o => {
                if (o.location.includes('side')) {
                    let x = (parseFeetInches(o.position) * 12 - width / 2) * scale;
                    let oHeight = o.type === 'Door' ? height : height * 0.8; // Simplified
                    rect(x, -oHeight * scale, o.width * scale, oHeight * scale);
                }
            });
            textSize(12);
            fill(0);
            text("Side View", -width * scale / 2, -height * scale - 20);
        }

        function drawFrontView() {
            let length = parseFeetInches(document.getElementById('length').value) * 12;
            let height = parseFeetInches(document.getElementById('height').value) * 12;
            let studSpacing = parseFloat(document.getElementById('studSpacing').value);
            let pitch = parseFloat(document.getElementById('roofPitch').value);
            let eaveOverhang = parseFloat(document.getElementById('eaveOverhang').value);
            let lumberSize = document.getElementById('lumberSize').value;

            background(255);
            stroke(0);
            strokeWeight(1);
            noFill();
            translate(100, 200);

            // Walls
            rect(-length * scale / 2, -height * scale, length * scale, height * scale);
            // Studs
            let studs = Math.floor(length / studSpacing) + 1;
            let thickness = studThickness[lumberSize] * scale;
            for (let i = 0; i <= studs; i++) {
                let x = -length * scale / 2 + (i * studSpacing) * scale;
                line(x - thickness / 2, -height * scale, x - thickness / 2, 0);
                line(x + thickness / 2, -height * scale, x + thickness / 2, 0);
            }
            // Roof
            let roofHeight = (length / 2) * (pitch / 12) * scale;
            line(-length * scale / 2 - eaveOverhang * scale, -height * scale, 0, -height * scale - roofHeight);
            line(0, -height * scale - roofHeight, length * scale / 2 + eaveOverhang * scale, -height * scale);
            // Rafters
            let rafterCount = Math.floor(length / studSpacing) + 1;
            let rafterThickness = studThickness['2x6'] * scale;
            for (let i = 0; i <= rafterCount; i++) {
                let x = -length * scale / 2 + (i * studSpacing) * scale;
                let yTop = -height * scale - (Math.abs(x / scale) * (pitch / 12)) * scale;
                line(x - rafterThickness / 2, -height * scale, x - rafterThickness / 2, yTop);
                line(x + rafterThickness / 2, -height * scale, x + rafterThickness / 2, yTop);
            }
            // Openings
            openings.forEach(o => {
                if (o.location.includes('front')) {
                    let x = (parseFeetInches(o.position) * 12 - length / 2) * scale;
                    let oHeight = o.type === 'Door' ? height : height * 0.8;
                    rect(x, -oHeight * scale, o.width * scale, oHeight * scale);
                }
            });
            textSize(12);
            fill(0);
            text("Front View", -length * scale / 2, -height * scale - 20);
        }

        function drawRafter() {
            let width = parseFeetInches(document.getElementById('width').value) * 12;
            let pitch = parseFloat(document.getElementById('roofPitch').value);
            let gableOverhang = parseFloat(document.getElementById('gableOverhang').value);

            background(255);
            stroke(0);
            strokeWeight(1);
            noFill();

            let run = (width / 2 + gableOverhang); // in inches
            let rise = (width / 2) * (pitch / 12); // in inches
            let rafterLength = Math.sqrt(run * run + rise * rise) / 12; // in feet
            let angle = Math.atan(pitch / 12) * 180 / Math.PI;
            let birdsmouthDepth = 0.5; // in feet
            let birdsmouthPosition = (width / 24) / Math.cos(Math.atan(pitch / 12)); // in feet
            let rafterWidth = 5.5 / 12; // e.g., 2x6 nominal width in feet

            let rafterScale = 150 / rafterLength; // Fit within 150 pixels
            translate(100, 150);
            rotate(-Math.atan(pitch / 12));

            // Draw rafter
            let xStart = 0;
            let xEnd = rafterLength * rafterScale;
            let yTop = rafterWidth * rafterScale / 2;
            let yBottom = -rafterWidth * rafterScale / 2;
            line(xStart, yTop, xEnd, yTop);
            line(xStart, yBottom, xEnd, yBottom);
            push();
            rotate(Math.atan(pitch / 12));
            line(xStart, yTop, xStart, yBottom);
            line(xEnd, yTop, xEnd, yBottom);
            pop();
            // Birdsmouth
            let birdsmouthX = birdsmouthPosition * rafterScale;
            line(birdsmouthX, yBottom, birdsmouthX, yBottom + birdsmouthDepth * rafterScale);
            line(birdsmouthX, yBottom + birdsmouthDepth * rafterScale, birdsmouthX - ((width / 24) * rafterScale / Math.cos(Math.atan(pitch / 12))), yBottom + birdsmouthDepth * rafterScale);

            // Annotations
            textSize(10);
            fill(0);
            push();
            rotate(Math.atan(pitch / 12));
            text(`Length: ${inchesToFeetInches(rafterLength * 12)}`, xStart + 10, yTop + 20);
            text(`Plumb Cut: ${angle.toFixed(2)}°`, xEnd - 50, yTop + 20);
            text(`Birdsmouth at ${inchesToFeetInches(birdsmouthPosition * 12)}`, birdsmouthX - 50, yBottom - 20);
            text(`Depth: ${inchesToFeetInches(birdsmouthDepth * 12)}`, birdsmouthX + 10, yBottom + birdsmouthDepth * rafterScale / 2);
            text("Rafter Diagram", -50, -50);
            pop();
        }

        function addOpening() {
            let type = document.getElementById('openingType').value;
            let width = parseFloat(document.getElementById('openingWidth').value);
            let position = document.getElementById('openingLocation').value;
            let location = Math.random() < 0.5 ? 'front' : 'side'; // Simplified random assignment
            openings.push({ type, width, position, location });

            let list = document.getElementById('openingsList');
            let li = document.createElement('li');
            li.textContent = `${type} at ${position} (Width: ${width}", ${location} wall)`;
            list.appendChild(li);
            updateAll();
        }

        function updateAll() {
            let length = parseFeetInches(document.getElementById('length').value) * 12;
            let width = parseFeetInches(document.getElementById('width').value) * 12;
            let height = parseFeetInches(document.getElementById('height').value) * 12;
            let studSpacing = parseFloat(document.getElementById('studSpacing').value);
            let pitch = parseFloat(document.getElementById('roofPitch').value);
            let eaveOverhang = parseFloat(document.getElementById('eaveOverhang').value);
            let gableOverhang = parseFloat(document.getElementById('gableOverhang').value);
            let kingStudsPerOpening = parseInt(document.getElementById('kingStudsPerOpening').value);
            let jackStudsPerOpening = parseInt(document.getElementById('jackStudsPerOpening').value);
            let blockingOption = document.getElementById('blockingOption').value;
            let lumberSize = document.getElementById('lumberSize').value;

            // Calculations
            let studsLength = Math.floor(length / studSpacing) + 1;
            let studsWidth = Math.floor(width / openingLocation) + 1;
            let wallStuds = 2 * (studsLength + studsWidth);
            let plates = 3 * (length + width) / 8; // Top and bottom plates
            let rafterCount = Math.floor(length / studSpacing) + 1;
            let run = (width / 2 + gableOverhang);
            let rise = (width / 2) * (pitch / 12);
            let rafterLength = Math.sqrt(run * run + rise * rise) / 12;
            let ridgeBeam = (width + 2 * gableOverhang) / 12; // Corrected to depth + 2 * gableOverhang
            let flyRafters = 2;
            let blockingPieces = blockingOption === 'Yes' ? (studsLength + studsWidth) * 2 : 0;
            let kingStuds = openings.length * kingStudsPerOpening;
            let jackStuds = openings.length * jackStudsPerOpening;
            let headers = openings.length;
            let hurricaneTies = rafterCount * 2;
            let rafterHangers = rafterCount * 2;
            let collarTies = Math.floor(rafterCount / 2);
            let joistHangers = 0; // Simplified
            let birdsmouthAngle = Math.atan(pitch / 12) * 180 / Math.PI;

            // Update results
            document.getElementById('studCount').textContent = wallStuds;
            document.getElementById('plateCount').textContent = Math.ceil(plates);
            document.getElementById('rafterCount').textContent = rafterCount * 2;
            document.getElementById('ridgeBeam').textContent = inchesToFeetInches(ridgeBeam * 12);
            document.getElementById('flyRafters').textContent = flyRafters;
            document.getElementById('blockingCount').textContent = blockingPieces;
            document.getElementById('kingStuds').textContent = kingStuds;
            document.getElementById('jackStuds').textContent = jackStuds;
            document.getElementById('headerCount').textContent = headers;
            document.getElementById('hurricaneTies').textContent = hurricaneTies;
            document.getElementById('rafterHangers').textContent = rafterHangers;
            document.getElementById('collarTies').textContent = collarTies;
            document.getElementById('joistHangers').textContent = joistHangers;
            document.getElementById('birdsmouthAngle').textContent = birdsmouthAngle.toFixed(2);
            document.getElementById('fullRafterLength').textContent = inchesToFeetInches(rafterLength * 12);

            // Cost estimation (simplified)
            let cost = (wallStuds * 5 + plates * 10 + rafterCount * 2 * 15 + ridgeBeam * 12 * 20 + flyRafters * 10 + blockingPieces * 3 + kingStuds * 5 + jackStuds * 5 + headers * 10 + hurricaneTies * 2 + rafterHangers * 5 + collarTies * 5);
            document.getElementById('totalCost').textContent = cost.toFixed(2);

            // Redraw
            drawTopView();
            drawSideView();
            drawFrontView();
            drawRafter();
        }

        function resetAll() {
            document.getElementById('length').value = '20-0';
            document.getElementById('width').value = '16-0';
            document.getElementById('height').value = '8-0';
            document.getElementById('studSpacing').value = 16;
            document.getElementById('roofPitch').value = 6;
            document.getElementById('lumberSize').value = '2x4';
            document.getElementById('eaveOverhang').value = 12;
            document.getElementById('gableOverhang').value = 12;
            document.getElementById('kingStudsPerOpening').value = 2;
            document.getElementById('jackStudsPerOpening').value = 2;
            document.getElementById('blockingOption').value = 'No';
            document.getElementById('openingType').value = 'Door';
            document.getElementById('openingWidth').value = 36;
            document.getElementById('openingLocation').value = '5-0';
            openings = [];
            document.getElementById('openingsList').innerHTML = '';
            updateAll();
        }

        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('change', updateAll);
        });

        setup();
    </script>
</body>
</html>
